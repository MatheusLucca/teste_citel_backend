# Sistema de Banco de Sangue - Back-end

Este projeto √© o back-end para um sistema de gerenciamento de banco de sangue, desenvolvido como parte de um teste t√©cnico. A aplica√ß√£o web baseada em Spring Boot processa dados de candidatos a doadores de sangue e fornece an√°lises estat√≠sticas atrav√©s de uma API REST.

## üìã Sobre o Projeto

O sistema processa dados de candidatos a doadores de sangue e apresenta an√°lises estat√≠sticas importantes, incluindo:

- Distribui√ß√£o de candidatos por estado brasileiro
- IMC m√©dio por faixa et√°ria (intervalos de 10 anos)
- Percentual de obesos entre homens e mulheres
- M√©dia de idade por tipo sangu√≠neo
- Quantitativo de poss√≠veis doadores para cada tipo sangu√≠neo receptor

> **Nota:** Somente pessoas com idade entre 16 a 69 anos e com peso acima de 50 Kg podem doar sangue.

## üöÄ Tecnologias Utilizadas

Este projeto foi desenvolvido com as seguintes tecnologias:

- **Java 21** - Linguagem de programa√ß√£o
- **Spring Boot 3.4.5** - Framework para cria√ß√£o de aplica√ß√µes Java
- **Spring Data JPA** - Simplifica√ß√£o do acesso a dados com JPA
- **MySQL** - Banco de dados relacional
- **Maven** - Gerenciamento de depend√™ncias e build

## üîß Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos

- JDK 21
- Maven 3.8+
- MySQL 8.0+
- Git (opcional)

### Configura√ß√£o do Banco de Dados

1. Certifique-se de que o MySQL est√° instalado e em execu√ß√£o.
2. O banco de dados `banco_sangue` ser√° criado automaticamente quando a aplica√ß√£o for executada pela primeira vez.
3. Configure as credenciais do banco de dados no arquivo `application.properties` ou use vari√°veis de ambiente:

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/banco_sangue?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
```

Para substituir as vari√°veis de ambiente, voc√™ pode:

- Definir as vari√°veis no seu sistema:
  ```bash
  export DB_USERNAME=seu_usuario
  export DB_PASSWORD=sua_senha
  ```
- Ou modificar diretamente o arquivo `application.properties`:
  ```properties
  spring.datasource.username=seu_usuario
  spring.datasource.password=sua_senha
  ```

### Instala√ß√£o

1. Clone o reposit√≥rio:
   ```bash
   git clone <url-do-repositorio>
   cd <nome-do-diretorio>
   ```

2. Compile o projeto:
   ```bash
   mvn clean install
   ```

3. Execute a aplica√ß√£o:
   ```bash
   mvn spring-boot:run
   ```

   Alternativamente, ap√≥s a compila√ß√£o, voc√™ pode executar o JAR gerado:
   ```bash
   java -jar target/demo-0.0.1-SNAPSHOT.jar
   ```

4. Usando vari√°veis de ambiente para configurar o banco de dados:
   ```bash
   DB_USERNAME=seu_usuario DB_PASSWORD=sua_senha mvn spring-boot:run
   ```
   
   Ou
   ```bash
   DB_USERNAME=seu_usuario DB_PASSWORD=sua_senha java -jar target/demo-0.0.1-SNAPSHOT.jar
   ```

> **Importante:** O servidor roda na porta 8080 (http://localhost:8080). Certifique-se de que esta porta esteja dispon√≠vel.

## üìù Scripts SQL

O projeto inclui um arquivo `schema.sql` que √© executado automaticamente durante a inicializa√ß√£o para criar a estrutura do banco de dados.

## üì± Funcionalidades e Endpoints da API

O sistema disponibiliza os seguintes endpoints REST:

### 1. Gerenciamento de Doadores
- **POST** `/api/doadores`: Cadastrar novos doadores
  - Corpo da requisi√ß√£o: Lista de objetos `DoadorDTO` em formato JSON
  - Resposta: Lista de `DoadorDTO` cadastrados

- **GET** `/api/doadores`: Listar todos os doadores cadastrados
  - Resposta: Lista de `DoadorDTO`

### 2. An√°lise Estat√≠stica
- **GET** `/api/doadores/estatisticas`: Obter estat√≠sticas detalhadas sobre os doadores
  - Resposta: Objeto `EstatisticasDTO` contendo:
    - Quantidade de candidatos por estado
    - IMC m√©dio por faixa et√°ria (de 10 em 10 anos)
    - Percentual de obesos entre homens e mulheres
    - M√©dia de idade por tipo sangu√≠neo
    - Quantidade de poss√≠veis doadores para cada tipo sangu√≠neo receptor

## üîó Integra√ß√£o com Frontend

A API foi projetada para integrar com o frontend atrav√©s de requisi√ß√µes HTTP. O CORS est√° configurado para aceitar requisi√ß√µes de `http://localhost:3000`.

## üìú Regras de Compatibilidade Sangu√≠nea

| Tipo sangu√≠neo | Pode doar para | Pode receber de |
|----------------|----------------|-----------------|
| A+             | A+, AB+        | A+, A-, O+, O-  |
| A-             | A+, A-, AB+, AB- | A-, O-        |
| B+             | B+, AB+        | B+, B-, O+, O-  |
| B-             | B+, B-, AB+, AB- | B-, O-        |
| AB+            | AB+            | Todos           |
| AB-            | AB+, AB-       | A-, B-, O-, AB- |
| O+             | A+, B+, O+, AB+ | O+, O-         |
| O-             | Todos          | O-              |

## üß™ Testes

### Executando os Testes

Para executar todos os testes do projeto:

```bash
mvn test
```

Para executar testes espec√≠ficos:

```bash
mvn test -Dtest=NomeDaClasseDeTeste
```

### Testes Unit√°rios Implementados

O projeto conta com testes unit√°rios abrangentes que garantem a qualidade e robustez do c√≥digo:

#### 1. Testes da Entidade (DoadorTest)
- C√°lculo correto de idade baseado na data de nascimento
- C√°lculo correto de IMC baseado em altura e peso
- Verifica√ß√£o de obesidade
- Verifica√ß√£o de elegibilidade para doa√ß√£o de sangue
- C√°lculo de faixa et√°ria
- Convers√£o de strings de data para LocalDate

#### 2. Testes de Mapeamento (DoadorMapperTest)
- Convers√£o de entidade Doador para DoadorDTO
- Convers√£o de DoadorDTO para entidade Doador
- Mapeamento de listas entre entidades e DTOs
- Formata√ß√£o correta de datas nos DTOs

#### 3. Testes de Servi√ßo (DoadorServiceTest)
- Salvamento de doadores
- Listagem de doadores
- Valida√ß√£o de CPF duplicado
- Gera√ß√£o de estat√≠sticas:
  - Contagem de candidatos por estado
  - C√°lculo de IMC m√©dio por faixa et√°ria
  - C√°lculo de percentual de obesos entre homens e mulheres
  - C√°lculo de idade m√©dia por tipo sangu√≠neo
  - Contagem de poss√≠veis doadores por tipo sangu√≠neo receptor

Os testes utilizam JUnit 5 e Mockito para criar simula√ß√µes (mocks) de componentes e verificar comportamentos esperados.

A cobertura de testes abrange os principais fluxos de neg√≥cio e cen√°rios de borda, garantindo que a aplica√ß√£o se comporte conforme esperado mesmo em situa√ß√µes excepcionais.

## ‚öôÔ∏è Configura√ß√£o CORS

A aplica√ß√£o est√° configurada para permitir requisi√ß√µes CORS de `http://localhost:3000`. Se o frontend estiver rodando em outra porta ou host, voc√™ precisar√° modificar a classe `CorsConfig.java`:

```java
registry.addMapping("/**")
        .allowedOrigins("http://seu-frontend-url")
        .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
        .allowedHeaders("*");
```

## üìä Modelo de Dados

### Doador
```java
public class Doador {
    private Long id;
    private String nome;
    private String cpf;          // √önico no sistema
    private String rg;
    private LocalDate dataNascimento;
    private String sexo;         // "Masculino" ou "Feminino"
    private String mae;
    private String pai;
    private String email;
    private String cep;
    private String endereco;
    private Integer numero;
    private String bairro;
    private String cidade;
    private String estado;       // Sigla UF
    private String telefoneFixo;
    private String celular;
    private Double altura;       // Em metros
    private Double peso;         // Em kg
    private String tipoSanguineo;// "A+", "A-", "B+", "B-", "AB+", "AB-", "O+", "O-"
}
```

## ‚ùì Resolu√ß√£o de Problemas

### Erro de Conex√£o com o Banco

Se voc√™ encontrar erros de conex√£o com o banco de dados:

1. Verifique se o MySQL est√° em execu√ß√£o
2. Confirme se as credenciais est√£o corretas
3. Verifique se o usu√°rio tem permiss√µes suficientes

### Erro de CORS

Se encontrar erros de CORS ao acessar a API do frontend:

1. Verifique se a origem do frontend est√° corretamente configurada em `CorsConfig.java`
2. Certifique-se de que o navegador n√£o est√° bloqueando requisi√ß√µes


## üìã Maven Commands

- `mvn clean` - Limpa o diret√≥rio target
- `mvn compile` - Compila o c√≥digo fonte
- `mvn test` - Executa os testes
- `mvn package` - Empacota o projeto em um JAR
- `mvn install` - Instala o pacote no reposit√≥rio local
- `mvn spring-boot:run` - Executa a aplica√ß√£o
